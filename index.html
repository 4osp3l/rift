<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Rift</title>
<link rel="stylesheet" href="style.css" />
</head>
<body>
<div class="app">

  <!-- LEFT PANE -->
  <div class="left">
    <h1>Rift</h1>
    <p class="lead"></p>

    <label class="dropzone" id="dropzone">
      Drop .zip here or <strong style="color:var(--accent)"> browse</strong>
      <input id="fileinput" type="file" accept=".zip" />
    </label>

    <div class="meta" id="meta"></div>

    <div class="files">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
        <strong>Files</strong>
        <button class="btn btn-ghost" id="downloadAll">Download</button>
      </div>
      <ul class="filelist" id="filelist"></ul>
    </div>
  </div>

  <!-- MIDDLE PANE -->
  <div class="right">
    <div class="toolbar">
      <div style="flex:1">Preview</div>
      <button class="btn" id="clear">Clear</button>
    </div>

    <div class="preview" id="preview">
      <div class="empty" id="empty">
        
      </div>
    </div>
  </div>

  <!-- RIGHT PANE: AI Assistant -->
  <div class="ai-pane" id="aiPane">
    <div class="ai-header">AI Assistant</div>

    <div class="ai-messages" id="aiMessages"></div>

    <div class="ai-input-bar">
      <input id="aiInput" type="text" placeholder="Ask the AIâ€¦" />
      <button id="aiSend">Send</button>
    </div>
  </div>

</div>

<script src="jszip.min.js"></script>
<script src="lz-string.min.js"></script>
<script src="popup.js"></script>

<script>
const k1 = "AI";
const k2 = "zaSy";
const k3 = "CdXwYB";
const k4 = "5RKYz-b";
const k5 = "TyUSf6mGQz3";
const k6 = "MUgvg0jA8";

const GEMINI_API_KEY = k1 + k2 + k3 + k4 + k5 + k6;
  
// Gemini API call
async function sendToGemini(promptText){
  try{
    const res = await fetch(
      "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=" + GEMINI_API_KEY,
      {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({
          contents:[{ parts:[{ text: promptText }] }]
        })
      }
    );
    const data = await res.json();
    return data?.candidates?.[0]?.content?.parts?.[0]?.text || "No response";
  } catch(e){
    console.error("Gemini API error:", e);
    return "Error contacting Gemini API";
  }
}

const aiMessages = document.getElementById("aiMessages");
const aiInput = document.getElementById("aiInput");
const aiSend = document.getElementById("aiSend");

// Store currently selected file content
let currentFileContent = "";

// Call this whenever a file is clicked/previewed
function previewFile(content){
  currentFileContent = content; // store file content for AI
  const preview = document.getElementById("preview");
  preview.textContent = content;
}

// Add message to chat
function addMsg(text, type){
  const div = document.createElement("div");
  div.className = "ai-msg " + (type==="user"?"ai-user":"ai-bot");
  div.textContent = text;
  aiMessages.appendChild(div);
  aiMessages.scrollTop = aiMessages.scrollHeight;
  return div;
}


// Show typing dots
function showTyping(){
  const typingDiv = document.createElement("div");
  typingDiv.className = "ai-typing";
  typingDiv.innerHTML = `<div class="dot"></div><div class="dot"></div><div class="dot"></div>`;
  aiMessages.appendChild(typingDiv);
  aiMessages.scrollTop = aiMessages.scrollHeight;
  return typingDiv;
}

// Stream message with typing effect
async function streamMsg(prompt){
  // Show typing dots
  const typingDiv = showTyping();
  await new Promise(r=>setTimeout(r,300)); // small delay for UX

  // Check for "read/analyze current file" commands
  if(
    prompt.toLowerCase().includes("read current file") ||
    prompt.toLowerCase().includes("analyze file") ||
    prompt.toLowerCase().includes("look at current file")
  ){
    if(currentFileContent){
      prompt = `The user asked: "${prompt}". Here's the content of the currently selected file:\n\n${currentFileContent}\n\nPlease analyze or explain.`;
    } else {
      prompt = `The user asked: "${prompt}", but no file is currently selected.`;
    }
  }

  // Get AI response
  const full = await sendToGemini(prompt);

  // Remove typing dots
  typingDiv.remove();

  // Add AI message and simulate typing
  const botDiv = addMsg("", "bot");
  for(let i=0;i<full.length;i++){
    botDiv.textContent += full[i];
    aiMessages.scrollTop = aiMessages.scrollHeight;
    await new Promise(r=>setTimeout(r,15));
  }
}

// Event listeners
aiSend.addEventListener("click", async ()=>{
  const txt = aiInput.value.trim();
  if(!txt) return;
  addMsg(txt,"user");
  aiInput.value="";
  await streamMsg(txt);
});

aiInput.addEventListener("keypress", (e)=>{
  if(e.key==="Enter") aiSend.click();
});



</script>

</body>
</html>








